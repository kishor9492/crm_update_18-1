{% extends 'crm/base.html' %}

{% block content %}
<style>
    /* Page-specific overrides only */
    main {
        background: linear-gradient(135deg, var(--color-primary) 0%, var(--color-primary-light) 100%);
    }
</style>

<div class="container">
    <!-- Page Header -->
    <div class="page-header">
        <h2>ğŸ“… Meetings Management</h2>
        <p>Track and manage client meetings efficiently</p>
    </div>

    <!-- Filter Card -->
    <div class="filter-card">
        <div class="filter-header">
            <div class="filter-title">Filter Meetings</div>
            <div class="action-buttons">
                {% if user.is_authenticated and user.is_superuser %}
                    <a href="{% url 'upload_meetings' %}" class="action-btn btn-upload">
                        <span>ğŸ“¤</span>
                        <span>Upload</span>
                    </a>
                {% endif %}
                <a href="{% url 'export_meetings' %}" class="action-btn btn-export">
                    <span>ğŸ’¾</span>
                    <span>Export</span>
                </a>
            </div>
        </div>

        <form method="get" action="" class="filter-form">
            <div class="form-group">
                <label for="remark">Status</label>
                <select name="remark" id="remark">
                    <option value="">All</option>
                    <option value="Pending" {% if filter_remark == 'Pending' %}selected{% endif %}>Pending</option>
                    <option value="Completed" {% if filter_remark == 'Completed' %}selected{% endif %}>Completed</option>
                </select>
            </div>

            <div class="form-group">
                <label for="start_date">Start Date</label>
                <input type="date" name="start_date" id="start_date" value="{{ start_date|default:'' }}">
            </div>

            <div class="form-group">
                <label for="end_date">End Date</label>
                <input type="date" name="end_date" id="end_date" value="{{ end_date|default:'' }}">
            </div>

            <div class="form-group">
                <label for="search">Search</label>
                <input type="text" name="search" id="search" placeholder="Client or RM..." value="{{ search_query|default:'' }}">
            </div>

            <div class="form-group">
                <button type="submit">ğŸ” Search</button>
            </div>
        </form>
    </div>

    <!-- Meetings Table -->
    <div class="table-card">
        <div class="table-container">
            <table>
                <thead>
                    <tr>
                        <th>Client</th>
                        <th>RM</th>
                        <th>Date</th>
                        <th>Notes</th>
                        <th>Status</th>
                        <th>Updated</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for meeting in page_obj %}
                    <tr>
                        <td style="font-weight: 600;">{{ meeting.client.name }}</td>
                        <td>{{ meeting.relationship_manager.get_full_name }}</td>
                        <td>{{ meeting.date|date:"M d, Y" }}</td>
                        <td>{{ meeting.notes|truncatewords:10 }}</td>
                        <td>
                            <span class="badge {% if meeting.remark == 'Pending' %}badge-warning{% else %}badge-success{% endif %}">
                                {{ meeting.remark }}
                            </span>
                        </td>
                        <td>{{ meeting.updated_time|date:"M d, Y H:i" }}</td>
                        <td>
                            <div class="table-actions">
                                <a href="{% url 'update_meeting' meeting.id %}" class="btn-action btn-update">âœï¸ Update</a>
                                <a href="{% url 'delete_meeting' meeting.id %}" class="btn-action btn-delete" onclick="return confirm('Are you sure?')">ğŸ—‘ï¸ Delete</a>
                            </div>
                        </td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="7">
                            <div class="empty-state">
                                <div class="empty-state-icon">ğŸ“­</div>
                                <h3 style="color: var(--color-text); margin-bottom: 10px;">No meetings found</h3>
                                <p>Try adjusting your filters or create a new meeting</p>
                            </div>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

    <!-- Pagination -->
    <div class="pagination">
        {% if page_obj.has_previous %}
            <a href="?page=1{% if filter_remark %}&remark={{ filter_remark }}{% endif %}{% if start_date %}&start_date={{ start_date }}{% endif %}{% if end_date %}&end_date={{ end_date }}{% endif %}{% if search_query %}&search={{ search_query }}{% endif %}">First</a>
            <a href="?page={{ page_obj.previous_page_number }}{% if filter_remark %}&remark={{ filter_remark }}{% endif %}{% if start_date %}&start_date={{ start_date }}{% endif %}{% if end_date %}&end_date={{ end_date }}{% endif %}{% if search_query %}&search={{ search_query }}{% endif %}">Previous</a>
        {% else %}
            <span class="disabled">First</span>
            <span class="disabled">Previous</span>
        {% endif %}

        <span>Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}</span>

        {% if page_obj.has_next %}
            <a href="?page={{ page_obj.next_page_number }}{% if filter_remark %}&remark={{ filter_remark }}{% endif %}{% if start_date %}&start_date={{ start_date }}{% endif %}{% if end_date %}&end_date={{ end_date }}{% endif %}{% if search_query %}&search={{ search_query }}{% endif %}">Next</a>
            <a href="?page={{ page_obj.paginator.num_pages }}{% if filter_remark %}&remark={{ filter_remark }}{% endif %}{% if start_date %}&start_date={{ start_date }}{% endif %}{% if end_date %}&end_date={{ end_date }}{% endif %}{% if search_query %}&search={{ search_query }}{% endif %}">Last</a>
        {% else %}
            <span class="disabled">Next</span>
            <span class="disabled">Last</span>
        {% endif %}
    </div>
</div>
{% endblock %}
