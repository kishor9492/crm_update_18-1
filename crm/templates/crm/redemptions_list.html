{% extends 'crm/base.html' %}

{% block content %}
<style>
    .page-header {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 30px;
        border-radius: 10px;
        margin-bottom: 30px;
    }

    .filter-card {
        background: white;
        padding: 20px;
        border-radius: 10px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        margin-bottom: 30px;
    }

    .data-table {
        width: 100%;
        border-collapse: collapse;
        background: white;
        border-radius: 10px;
        overflow: hidden;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    }

    .data-table thead {
        background: linear-gradient(135deg, #667eea, #764ba2);
        color: white;
    }

    .data-table th,
    .data-table td {
        padding: 15px;
        text-align: left;
        border-bottom: 1px solid #eee;
    }

    .data-table tbody tr:hover {
        background: #f8f9fa;
    }

    .badge {
        padding: 5px 12px;
        border-radius: 20px;
        font-size: 0.85rem;
        font-weight: 600;
    }

    .badge-sip {
        background: #e3f2fd;
        color: #1976d2;
    }

    .badge-lump {
        background: #f3e5f5;
        color: #7b1fa2;
    }

    .badge-redemption {
        background: #ffebee;
        color: #c62828;
    }

    .btn-action {
        padding: 6px 12px;
        border-radius: 5px;
        text-decoration: none;
        font-size: 0.85rem;
        margin-right: 5px;
    }

    .btn-edit {
        background: #4bc1c1;
        color: white;
    }

    .btn-delete {
        background: #dc3545;
        color: white;
    }
</style>

<div class="page-header">
    <h2>ðŸ’° Redemptions</h2>
    <p>Track SIP stops, partial and full redemptions</p>
</div>

<div class="filter-card">
    <form method="GET" style="display: flex; flex-wrap: wrap; gap: 15px; align-items: center;">
        <input type="text" name="search" placeholder="Search client or fund..." value="{{ search }}"
            style="padding: 10px; border: 1px solid #ddd; border-radius: 5px; min-width: 200px;">

        <select name="product" style="padding: 10px; border: 1px solid #ddd; border-radius: 5px;">
            <option value="">All Products</option>
            {% for code, name in product_choices %}
            <option value="{{ code }}" {% if product == code %}selected{% endif %}>{{ name }}</option>
            {% endfor %}
        </select>

        <select name="redemption_type" style="padding: 10px; border: 1px solid #ddd; border-radius: 5px;">
            <option value="">All Types</option>
            {% for code, name in redemption_type_choices %}
            <option value="{{ code }}" {% if redemption_type == code %}selected{% endif %}>{{ name }}</option>
            {% endfor %}
        </select>

        <input type="date" name="start_date" value="{{ start_date }}"
            style="padding: 10px; border: 1px solid #ddd; border-radius: 5px;">
        <input type="date" name="end_date" value="{{ end_date }}"
            style="padding: 10px; border: 1px solid #ddd; border-radius: 5px;">

        <button type="submit"
            style="padding: 10px 25px; background: #667eea; color: white; border: none; border-radius: 5px; cursor: pointer;">
            Filter
        </button>
        <a href="{% url 'redemptions_list' %}"
            style="padding: 10px 20px; background: #e0e0e0; border-radius: 5px; text-decoration: none; color: #333;">
            Reset
        </a>
    </form>
</div>

<div class="card">
    <table class="data-table">
        <thead>
            <tr>
                <th>Client</th>
                <th>Product</th>
                <th>Type</th>
                <th>Fund Name</th>
                <th>Amount</th>
                <th>Date</th>
                <th>RM</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for redemption in page_obj %}
            <tr>
                <td><strong>{{ redemption.client.name }}</strong></td>
                <td><span class="badge badge-{{ redemption.product|lower }}">{{ redemption.product }}</span></td>
                <td><span class="badge badge-redemption">{{ redemption.get_redemption_type_display }}</span></td>
                <td>{{ redemption.fund_name|default:"-" }}</td>
                <td style="color: #c62828; font-weight: 600;">â‚¹{{ redemption.amount|floatformat:0 }}</td>
                <td>{{ redemption.redemption_date|date:"M d, Y" }}</td>
                <td>{{ redemption.relationship_manager.get_full_name }}</td>
                <td>
                    <a href="{% url 'update_redemption' redemption.id %}" class="btn-action btn-edit">Edit</a>
                    <a href="{% url 'delete_redemption' redemption.id %}" class="btn-action btn-delete">Delete</a>
                </td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="8" style="text-align: center; padding: 40px; color: #888;">
                    No redemptions found.
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

{% if page_obj.has_other_pages %}
<div style="margin-top: 20px; text-align: center;">
    {% if page_obj.has_previous %}
    <a href="?page={{ page_obj.previous_page_number }}&search={{ search }}&product={{ product }}"
        style="padding: 8px 16px; background: #667eea; color: white; border-radius: 5px; text-decoration: none; margin: 0 5px;">
        Previous
    </a>
    {% endif %}

    <span style="margin: 0 10px; color: #666;">Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}</span>

    {% if page_obj.has_next %}
    <a href="?page={{ page_obj.next_page_number }}&search={{ search }}&product={{ product }}"
        style="padding: 8px 16px; background: #667eea; color: white; border-radius: 5px; text-decoration: none; margin: 0 5px;">
        Next
    </a>
    {% endif %}
</div>
{% endif %}
{% endblock %}